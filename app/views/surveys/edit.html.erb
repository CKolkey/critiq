<%= render partial: "shared/sidebar" %>
<div class="main-content">

  <!-- This partial containes stuff that was in the template but I have no -->
  <!-- idea what its for, so it's commented out -->
  <%#= render partial: "shared/dashkit_top_navbar" %>

  <!-- HEADER -->
  <div class="header no-b-margin">
    <div class="container-fluid">

      <!-- Body -->
      <div class="header-body">
        <div class="row align-items-end">
          <div class="col-8">

            <!-- Pretitle -->
            <h6 class="header-pretitle">
              CRITIQ
            </h6>

            <!-- Title -->
            <h1 class="header-title">
              Create
            </h1>

          </div>
          <div class="col-4">

            <!-- Button -->


          </div>
        </div>
        <!-- / .row -->
      </div>
      <!-- / .header-body -->

    </div>
  </div>
  <!-- / .header -->

  <!-- LEFT and RIGHT panes -->
  <div class="container-fluid d-flex overflow-a" style="max-width:900px;">
    <div class="all-questions">
      <div class="title_and_description mb-5">
        <div class="header-title-survey">
          <h1 style="margin-top:20px;"><%= @survey.title %></h1>
          <p style="margin-top:20px;"><%= @survey.created_at.strftime("%e %B %Y")%></p>
        </div>
        <h3 style="color: grey;"><%= @survey.description %></h3>
      </div>
      <%= simple_form_for @survey do |f| %>
        <div class="wrapper-title-survey">
          <%= f.input :title,
                      wrapper_html: { class: 'title-input-text' }%>
          <%= f.input :description,
                      wrapper_html: { class: 'description-input-text' } %>
        <div class="slack-channels">
          <div class="w-50">
            <h4>Get Critiq from your colleagues in:</h4>
          </div>
          <div class="w-50">

            <%= f.collection_select :channel_id,
                  @slackchannels,
                  ->(item) { item[:id] },
                  ->(item) { item[:name].capitalize }
                  %>

          </div>
          <p>The survey will be sent out to <strong>each member</strong> of the group <strong>individually</strong>.</p>
        </div>
        </div>
        <!-- nested form for creating questions -->
        <div id="questions">
          <%= f.simple_fields_for :questions do |f| %>
            <%= render 'question_fields', f: f %>
          <% end %>

            <div class="links">
              <%#= link_to_add_association 'add question', f, :questions, class:"btn btn-primary" %>
               <%= link_to_add_association '<i class="fas fa-plus-circle"></i>'.html_safe, f, :questions, class:"question-icon" %>
            </div>
        </div>
        <%= f.input :published, :as => :hidden, :input_html => { :value => "true" } %>
        <!-- save & send (currently) -->
        <div class="form-create-footer text-right px-5">
          <%= f.submit "Submit Critiq", class:"btn btn-primary create-survey-button-edit" %>
        </div>
        <!-- only save action; do not send! -->
        <div class="form-create-footer text-right px-20">
          <%= f.submit "Save Critiq", class:"btn btn-primary create-survey-button-edit" %>
        </div>
      <% end %>
    </div>



  </div>
</div>



<!-- END  -->
<%= content_for :after_js do %>
  <script>
    const clickPlus = () => {
      document.querySelector('.question-icon').click()
    };

    $( document ).ready(function(){
      clickPlus();

      const mcFormDropdown = document.querySelector('.form-control.select.optional');

      mcFormDropdown.addEventListener('change', function (event) {
        if (this.value === "radio"){
          document.querySelector('.mc-form-create-link').classList.remove("mc-hidden");
          document.querySelector('.create-form-choices').classList.add("mc-choice-bump-height");
        } else {
          document.querySelector('.mc-form-create-link').classList.add("mc-hidden");
          document.querySelector('.create-form-choices').classList.remove("mc-choice-bump-height");
        };
      });

    })

  </script>
<% end %>
